%
\chapter{Creating video-summaries}
%
\section{Method}
%
In the previous chapter we computed a number of labels that helps us identify the contextuality of a video. In this chapter we will attempt to create a video based on a recipe where each ingredient expresses a desire of how each scene should be described.
%
\subsection{Recipe}
%
% recipies - simple approach. no immediate feedback. kinda skipped lit. study on this one. universal recipe. 2 permutations on each dataset (different alpha_span value), and added some required labels 
% recipe structure: list of ingredients (labels, min/max span, interval, span alpha, required/forbidden labels)
A recipe is one or more ingredients in a specific order, much like a cooking recipe. Each ingredient is described by
%
\begin{itemize}
\item labels - labels present in a segment has a positive impact on the segment score
\item min. span - segments should be no shorter than this
\item max. span - segments should be no longer than this
\item interval - [LAUGE]
\item span alpha - weighing of labels vs. segment length
\item required labels - labels not present in a segment has a negative impact on the segment score
\item forbidden labels - labels present in a segment has a negative impact on the segment score
\end{itemize}
%
Each ingredient corresponds to a segment of real video footage, ie. given a specific ingredient we must find the segment that matches it the best.
%
\subsection{Choosing a Segment}
%
A segment is a start and end frame, the label it contains, and the respective video the segment appears in. Each segment is assigned a score and is picked with probability $P$ defined by: 
%
\[
P = \frac{s^2}{S},
\]
%
where $s$ is the score of a given candidate, and the score sum, $S$, is defined as:
%
\[
S = \sum_{i=0}^{n} s_{i}^2,
\]
%
where $n$ is the number of candidates, and $s_i$ is the score of candidate $i$.
%
\subsection{Segment Score}\label{sec:segment_score}
%
% Remember to mention that segments chosen in part 3 are marked as used and can't be chosen again in that video.
%
The most fitting sub-parts of the video are found and scored based on how well they fulfill the label requirements we have constructed for the segment in question as well as how well they match the time span we are looking to fill. Each aspect is encapsulated in each their seperate fulfilment ratio, which are then later combined into a final score.
%
\subsubsection{Label fulfilment}
%
For each video in the candidate group we analyse each frame in regards to the labels present (or not present) in it. From this we generate a graph representing how well each frame throughout the video fulfills the label requirements we have for the segment to be chosen. Let $L_{x}$ be the set of labels we would like to be present in the segment, $n$ be the number of labels in $L_{x}$, $L_{y}$ be the set of labels which we require to be present, and $L_{z}$ be the set of labels which are forbidden to be present. Also let $f_{l}$ and $f_{n}$ be the set of requested labels present in frame $f$, and the number of requested labels present in frame $f$, respectively, where $f$ is a frame in the video. The requirement fulfilment-ratio for each frame is defined like this:\\
%
\begin{equation}
R(f) = \frac{f_{n}}{n} \cdot Y(f) \cdot Z(f)
\end{equation} 
%
, where\\
%
\begin{equation}
Y(f) =
\begin{cases}
0 & \text{, if} f_{l} \cap L_{y} \neq L_{y}\\
1 &  \text{, otherwise}
\end{cases}
\end{equation} 
%
, and\\
%
\begin{equation}
Z(f) =
\begin{cases}
0 & \text{, if} f_{l} \cap L_{z} \neq \emptyset\\
1 &  \text{, otherwise}
\end{cases}
\end{equation} 
%
\\
%
Effectively this means that a frame will receive a fulfilment-ratio of 0 percent if it does not contain a required label or if it contains a forbidden one, and the ratio of the number of requested labels it contains, otherwise.\\
%
With this fulfillment ratios across the entire span of the video we now have a tool of measure to identify the parts of it, that best fit the label requirements.
%
\subsubsection{Time span fulfilment}
%
The other aspect used to determine the score of a sub-part of a video is how well it fits within the time span we are looking to fill. A minimum- and maximum- length defines the time span, that we want the final segment to cover. Let $T_{min}$ and $T_{max}$ be the the minimum- and maximum- length, respectively, and let $l$ be the length of the sub-part in frames. The time span fulfilment ratio is then defined as:\\
%
\begin{equation}
\tau(l) =
\begin{cases}
1 & \text{, if } T_{max} = T_{min}\\
\frac{l-T_{min}}{T_{max}-T_{min}} &  \text{, otherwise}
\end{cases}
\end{equation} 
%
\\
%
A sub-part of minimum length will thus have time span fulfilment ratio of zero, while one of maximum length will have a ratio of one. 
%
\subsubsection{Segment Score}
%
The score for a sub-part is based on how well it fulfils the label- as well as the time span-requirement. A ratio, $\alpha$, determines how the two are weighted against each other. Let $R$ be a set of the label fulfilment ratios for each frame in the video, define in [FORMULA:REF]. Also, for each possible sub-part (that does not exceed the maximum length defined in the time span requirement), let $v$ be the frame number where the sub-part begins, $w$ be the frame number where it ends, and $l$ be the length of it in frames. The score for the sub-part is then defined as:\\
%
\begin{equation}
S(v,w) =(1-\alpha) \cdot \sum_{i=v}^{w} \frac{R(i)}{l} + \alpha \cdot \tau(l)
\end{equation}
%
% Kim var forvirret over at L_{i} (nu omdøbt til R(i)) ikke hed det samme som i den tidligere formel. Check hele denne formel igen og hver sikker på at den giver mening.
%
% Noter fra Kim: Argumenter for formlen. Hvorfor virker den?
%
The score is thus determined by the average label fulfilment rate in the sub-part, weighted against the time span it covers.
%
\subsection{Candidates}
%
To avoid computing a score for all segments in all videos, we find the most promising ones and call these candidates. The candidates are defined as all permutations of segments for which a select set, $L$, of labels is present.
Overlapping segments is added to the candidates, where overlapping segments are defined as such if they both originate from the same source video, do not share the same label, and 
%
\[
\text{max}(a, c) < \text{min}(b, d),
\]
%
where $a$ and $b$ are the start and end frame in the first segment, and $c$ and $d$ are the start and end frame in the second segment. If the segments overlap a new segment, $c$, has the union of labels in the two segments, and
%
\[
x,y = \text{max}(a, c), \text{min}(b, d),
\]
%
where $x$ is the start frame in segment $c$ and $y$ is the end frame in segment $c$. if $y-x < \tau$, for some treshold $\tau$, segment $c$ is discarded, ie. the overlap is too small for $c$ to be considered a real segment.\\
The candidates are sorted by number of labels in each candidate (the most relevant candidate is usually the one where multiple labels overlap). The topmost candidates are the most promising, and a score for each is computed as described in section \ref{sec:segment_score}.
%